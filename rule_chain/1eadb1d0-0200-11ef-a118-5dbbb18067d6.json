{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "4f6242f0-0200-11ef-a118-5dbbb18067d6"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "1eadb1d0-0200-11ef-a118-5dbbb18067d6"
    },
    "name" : "get_k",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 1,
      "toIndex" : 3,
      "type" : "16"
    }, {
      "fromIndex" : 1,
      "toIndex" : 4,
      "type" : "14"
    }, {
      "fromIndex" : 1,
      "toIndex" : 5,
      "type" : "15"
    }, {
      "fromIndex" : 1,
      "toIndex" : 6,
      "type" : "13"
    }, {
      "fromIndex" : 1,
      "toIndex" : 7,
      "type" : "12"
    }, {
      "fromIndex" : 3,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 4,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 5,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 7,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 8,
      "toIndex" : 12,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 10,
      "type" : "Success"
    }, {
      "fromIndex" : 11,
      "toIndex" : 8,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 9,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 0,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 369,
        "layoutY" : 166
      },
      "configuration" : {
        "persistAlarmRulesState" : false,
        "fetchAlarmRulesStateOnStart" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4f6242f0-0200-11ef-a118-5dbbb18067d6"
      },
      "name" : "information_k",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.profile.TbDeviceProfileNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 626,
        "layoutY" : 165
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "function nextRelation(metadata, msg) {\n    return ['one','nine'];\n}\nif(msgType === 'POST_TELEMETRY_REQUEST') {\n    return ['two'];\n}\nreturn nextRelation(metadata, msg);",
        "tbelScript" : "function nextRelation(metadata, msg) {\r\n        \tif (metadata.deviceName === '24011607330012') {\r\n        \t\treturn ['12'];\r\n        \t} else if (metadata.deviceName === '24011607330013') {\r\n        \t\treturn ['13'];\r\n        \t} else if (metadata.deviceName === '24011607330014') {\r\n        \t\treturn ['14'];\r\n        \t}else if (metadata.deviceName === '24011607330015') {\r\n        \t\treturn ['15'];\r\n        \t}else if (metadata.deviceName === '24011607330016') {\r\n        \t\treturn ['16'];\r\n        \t}\r\n        }\r\n\r\n        return nextRelation(metadata, msg);"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3af97120-0206-11ef-bf1e-eb47e687e405"
      },
      "name" : "k",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 960,
        "layoutY" : 484
      },
      "configuration" : {
        "relationsQuery" : {
          "direction" : "FROM",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ ]
          } ],
          "fetchLastLevelOnly" : false
        },
        "originatorSource" : "CUSTOMER",
        "entityType" : null,
        "entityNamePattern" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "c2905340-0212-11ef-bef7-5131a0fcf1e6"
      },
      "name" : "kwh",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 921,
        "layoutY" : 331
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: {\"energy_kwh_16\": msg.energy_kwh}, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8d7dc9c0-0213-11ef-bef7-5131a0fcf1e6"
      },
      "name" : "kwh_16",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 949,
        "layoutY" : 215
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: {\"energy_kwh_14\": msg.energy_kwh}, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8d7df0d0-0213-11ef-bef7-5131a0fcf1e6"
      },
      "name" : "kwh_14",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 896,
        "layoutY" : 273
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "var newmsg={}\nreturn {msg: {\"energy_kwh_15\": msg.energy_kwh}, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8d7e17e0-0213-11ef-bef7-5131a0fcf1e6"
      },
      "name" : "kwh_15",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 908,
        "layoutY" : 140
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: {\"energy_kwh_13\": msg.energy_kwh},\n        metadata: metadata, \n        msgType: msgType};\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8d7e3ef0-0213-11ef-bef7-5131a0fcf1e6"
      },
      "name" : "kwh_13",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 912,
        "layoutY" : 82
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg:{\"energy_kwh_12\": msg.energy_kwh}, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8d7e6600-0213-11ef-bef7-5131a0fcf1e6"
      },
      "name" : "kwh_12",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1684,
        "layoutY" : 200
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "22ca3260-0215-11ef-bef7-5131a0fcf1e6"
      },
      "name" : "Save timeseries",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1399,
        "layoutY" : 444
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "var newMsg = {};\r\n\r\nnewMsg.deltaWh = parseFloat(Math.abs(msg.wh_15 - (msg.wh_12 + msg.wh_13 + msg.wh_14 + msg.wh_16)));\r\n\r\nreturn {\r\n    msg: newMsg,\r\n    metadata: metadata,\r\n    msgType: msgType\r\n    };"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "22ca5970-0215-11ef-bef7-5131a0fcf1e6"
      },
      "name" : "delta calculation",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1715,
        "layoutY" : 442
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "22ca8080-0215-11ef-bef7-5131a0fcf1e6"
      },
      "name" : "save timeseries",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1317,
        "layoutY" : 201
      },
      "configuration" : {
        "originatorSource" : "RELATED",
        "entityType" : null,
        "entityNamePattern" : null,
        "relationsQuery" : {
          "fetchLastLevelOnly" : false,
          "direction" : "TO",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ "ASSET" ]
          } ]
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "22caa790-0215-11ef-bef7-5131a0fcf1e6"
      },
      "name" : "to Asset",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1353,
        "layoutY" : 336
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "fetchTo" : "METADATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ ],
        "serverAttributeNames" : [ ],
        "latestTsKeyNames" : [ "wh_12", "wh_13", "wh_14", "wh_15", "wh_16" ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugMode" : true,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "22caa791-0215-11ef-bef7-5131a0fcf1e6"
      },
      "name" : "Fetch lastest timeseries",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}